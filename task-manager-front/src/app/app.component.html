<app-confirm-dialog></app-confirm-dialog>
<app-alert></app-alert>

<div class="main-layout">
  <aside class="sidebar">
    <!-- Language switcher sits above the brand, top-left -->
    <div class="sidebar-lang" style="margin-bottom: 10px">
      <app-language-switcher></app-language-switcher>
    </div>

    <h1 class="tasukeru-title">
      <span class="tasukeru-main">{{ "app.brand" | transloco }}</span>
      <span class="tasukeru-sub">{{ "boards.title" | transloco }}</span>
    </h1>

    <nav class="boards-list">
      @for (board of displayedBoards(); track board.id) { @if (board.id !==
      null) {
      <div
        (click)="selectBoard(board.id)"
        [class.selected]="selectedBoardId() === board.id"
        class="board-item"
      >
        {{ board.name }}
      </div>
      } @else {
      <input
        id="new-board-input"
        class="board-item board-edit-input"
        type="text"
        [value]="editingBoardValue()"
        (input)="onEditBoardInput($event)"
        (blur)="saveBoardEdit()"
        (keydown.enter)="saveBoardEdit()"
        (keydown.escape)="cancelBoardEdit()"
        required
        autofocus
        placeholder="{{ 'boards.namePlaceholder' | transloco }}"
      />
      } }

      <button
        class="add-board-btn"
        (click)="addBoard()"
        [disabled]="editingBoardId() !== null"
      >
        {{ "boards.add" | transloco }}
      </button>
    </nav>
  </aside>

  @if (selectedBoardId() !== null) {
  <section class="board-area">
    <header class="board-header">
      <div class="board-title-wrapper">
        @if (!editingSelectedBoard()) {
        <h2
          class="selected-board-title"
          tabindex="0"
          (click)="startSelectedBoardEdit()"
          (keydown.enter)="startSelectedBoardEdit()"
          (keydown.space)="startSelectedBoardEdit()"
          title="Click to edit board title"
          style="cursor: pointer"
        >
          <span class="board-title-text">{{ selectedBoardName }}</span>
          <button
            class="styled-x-btn"
            [title]="'boards.delete' | transloco"
            (click)="deleteSelectedBoard(); $event.stopPropagation()"
            aria-label="Delete board"
          >
            <img src="/svg/x.svg" alt="Delete" width="18" height="18" />
          </button>
        </h2>
        } @else {
        <input
          id="edit-selected-board-input"
          class="selected-board-title-edit"
          type="text"
          [value]="editingSelectedBoardValue()"
          (input)="onEditSelectedBoardInput($event)"
          (blur)="saveSelectedBoardEdit()"
          (keydown.enter)="saveSelectedBoardEdit()"
          (keydown.escape)="cancelSelectedBoardEdit()"
          maxlength="60"
          required
          autofocus
          placeholder="{{ 'boards.namePlaceholder' | transloco }}"
        />
        }
      </div>

      <button
        class="delete-btn styled-trash-btn delete-all-btn"
        (click)="deleteAllTasks()"
        [title]="'boards.deleteAll' | transloco"
      >
        <img src="/svg/trash.svg" alt="Delete all" width="19" height="19" />
        <span class="delete-all-label">{{
          "boards.deleteAll" | transloco
        }}</span>
      </button>
    </header>

    <app-board [boardId]="selectedBoardId()!"></app-board>
  </section>
  }
</div>

<!-- Fixed footer (does not push content, always visible) -->
<footer class="app-footer">
  Â© {{ currentYear }} {{ "app.brand" | transloco }}.
  {{ "app.copyright" | transloco }}
</footer>

<app-loading-overlay></app-loading-overlay>
