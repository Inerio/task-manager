<app-confirm-dialog></app-confirm-dialog>
<app-template-picker></app-template-picker>
<app-alert></app-alert>

<div class="main-layout">
  <aside class="sidebar">
    <!-- Switchers row -->
    <div class="sidebar-header">
      <app-language-switcher></app-language-switcher>
      <app-theme-switcher></app-theme-switcher>
    </div>

    <h1 class="tasukeru-title">
      <span class="tasukeru-main">{{ "app.brand" | transloco }}</span>
      <span class="tasukeru-sub">{{ "boards.title" | transloco }}</span>
    </h1>

    <nav class="boards-list">
      @for (board of displayedBoards(); track board.id; let i = $index) { @if
      (board.id !== null) {
      <div
        class="board-item"
        [class.selected]="selectedBoardId() === board.id"
        [class.drag-over]="dragOverBoardIndex() === i"
        draggable="{{ editingBoardId() === null }}"
        (click)="selectBoard(board.id)"
        (dragstart)="onBoardDragStart($event, board.id!)"
        (dragover)="onBoardDragOver($event, i)"
        (dragleave)="onBoardDragLeave(i)"
        (drop)="onBoardDrop($event, i)"
      >
        {{ board.name }}
      </div>
      } @else {
      <input
        id="new-board-input"
        class="board-item board-edit-input"
        type="text"
        [value]="editingBoardValue()"
        (input)="onEditBoardInput($event)"
        (blur)="saveBoardEdit()"
        (keydown.enter)="saveBoardEdit()"
        (keydown.escape)="cancelBoardEdit()"
        required
        autofocus
        placeholder="{{ 'boards.namePlaceholder' | transloco }}"
      />
      } } @if (canShowAdd()) {
      <button
        class="add-board-btn"
        (click)="addBoard()"
        [disabled]="editingBoardId() !== null"
      >
        {{ "boards.add" | transloco }}
      </button>
      }

      <div
        class="board-dropzone-end"
        [class.drag-over]="dropEndOver()"
        (dragover)="onBoardDragOverEnd($event)"
        (dragleave)="onBoardDragLeaveEnd()"
        (drop)="onBoardDropEnd($event)"
        aria-hidden="true"
      ></div>
    </nav>
  </aside>

  @if (selectedBoardId() !== null) {
  <section class="board-area">
    <header class="board-header">
      <div class="board-title-wrapper">
        @if (!editingSelectedBoard()) {
        <h2
          class="selected-board-title"
          tabindex="0"
          (click)="startSelectedBoardEdit()"
          (keydown.enter)="startSelectedBoardEdit()"
          (keydown.space)="startSelectedBoardEdit()"
          [attr.title]="'boards.editTitleHint' | transloco"
        >
          <span class="board-title-text">{{ selectedBoardName }}</span>
          <button
            class="styled-x-btn"
            [title]="'boards.delete' | transloco"
            (click)="deleteSelectedBoard(); $event.stopPropagation()"
            [attr.aria-label]="'boards.delete' | transloco"
          >
            <img
              src="/svg/x.svg"
              [attr.alt]="'boards.delete' | transloco"
              width="18"
              height="18"
            />
          </button>
        </h2>
        } @else {
        <input
          id="edit-selected-board-input"
          class="selected-board-title-edit"
          type="text"
          [value]="editingSelectedBoardValue()"
          (input)="onEditSelectedBoardInput($event)"
          (blur)="saveSelectedBoardEdit()"
          (keydown.enter)="saveSelectedBoardEdit()"
          (keydown.escape)="cancelSelectedBoardEdit()"
          maxlength="60"
          required
          autofocus
          placeholder="{{ 'boards.namePlaceholder' | transloco }}"
        />
        }
      </div>

      <button
        class="delete-btn styled-trash-btn delete-all-btn"
        (click)="deleteAllTasks()"
        [title]="'boards.deleteAll' | transloco"
      >
        <img
          src="/svg/trash.svg"
          [attr.alt]="'boards.deleteAll' | transloco"
          width="19"
          height="19"
        />
        <span class="delete-all-label">
          {{ "boards.deleteAll" | transloco }}
        </span>
      </button>
    </header>

    <app-board [boardId]="selectedBoardId()!"></app-board>
  </section>
  }
</div>

<footer class="app-footer">
  Â© {{ currentYear }} {{ "app.brand" | transloco }}.
  {{ "app.copyright" | transloco }}
</footer>

<app-loading-overlay></app-loading-overlay>
