<div
  #formContainer
  class="task-form editing-task-form"
  appStopBubbling
  appClickOutside
  (clickOutside)="showEmojiPicker.set(false)"
  coIgnore=".emoji-picker-dropdown"
  [formGroup]="form"
>
  <input
    #titleInput
    class="form-control"
    type="text"
    formControlName="title"
    [placeholder]="'task.titlePlaceholder' | transloco"
    [attr.aria-label]="'task.titlePlaceholder' | transloco"
    required
    autocomplete="off"
  />

  <div class="desc-row-edit" style="position: relative">
    <textarea
      #descTextarea
      class="form-control textarea"
      formControlName="description"
      [placeholder]="'task.descriptionPlaceholder' | transloco"
      [attr.aria-label]="'task.descriptionPlaceholder' | transloco"
      rows="4"
    ></textarea>

    <span
      class="emoji-trigger-bottom"
      (click)="toggleEmojiPicker(); $event.stopPropagation()"
      [attr.title]="'task.insertEmoji' | transloco"
    >
      <img
        src="/svg/smile-plus.svg"
        [attr.alt]="'task.addEmoji' | transloco"
        width="18"
        height="18"
        draggable="false"
      />
    </span>

    @if (showEmojiPicker()) {
    <app-emoji-picker
      class="emoji-picker-dropdown"
      (emojiSelected)="onEmojiSelected($event)"
    ></app-emoji-picker>
    }
  </div>

  <input
    class="form-control"
    type="date"
    formControlName="dueDate"
    [placeholder]="'task.dueDatePlaceholder' | transloco"
    [attr.aria-label]="'task.dueDatePlaceholder' | transloco"
    autocomplete="off"
  />

  <!-- Hide attachments zone ONLY on Brave (both create & edit use this form) -->
  @if (!isBrave()) {
  <app-attachment-zone
    [attachments]="localTask().attachments ?? []"
    [taskId]="localTask().id ?? -1"
    [acceptTypes]="acceptTypes"
    [maxSize]="maxSize"
    (filesUploaded)="onFilesBuffered($event)"
    (fileDeleted)="onBufferedFileDelete($event)"
    (fileDownloaded)="onFileDownload($event)"
    [creationMode]="!localTask().id"
    [pendingFiles]="pendingFiles()"
    (dialogOpen)="onDialogOpen($event)"
  ></app-attachment-zone>
  }

  <div class="btn-group">
    <button class="btn btn-success" type="button" (click)="handleSave()">
      {{
        editMode ? ("common.save" | transloco) : ("common.create" | transloco)
      }}
    </button>
    <button class="btn btn-secondary" type="button" (click)="handleCancel()">
      {{ "common.cancel" | transloco }}
    </button>
  </div>
</div>
