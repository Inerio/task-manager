<div
  class="attachments-zone"
  [class.has-attachments]="
    attachments.length || (creationMode && pendingFiles.length)
  "
  [class.drag-over]="isDragging()"
  appStopBubbling
  appDropzone
  [dzAccept]="acceptTypes"
  (dzFiles)="onFilesSelected($event)"
  (dzStateChange)="isDragging.set($event)"
  (click)="onZoneClick()"
>
  <!-- Hidden file input -->
  <input
    type="file"
    #fileInput
    (change)="onFileSelect($event)"
    [accept]="acceptTypes"
    multiple
    hidden
  />

  <!-- Attached files -->
  @if (attachments.length > 0) {
  <div class="attachment-tags">
    @for (filename of getUniqueAttachments(); track trackByFilename($index,
    filename)) {
    <app-attachment-tag
      [filename]="filename"
      (download)="onDownloadAttachment(filename)"
      (delete)="onDeleteAttachment(filename)"
      appPreviewHover
      [phTaskId]="taskId"
      [phFilename]="filename"
      (phShow)="onPreviewShow($event)"
      (phMove)="onPreviewMove($event)"
      (phHide)="onPreviewHide()"
    />
    }
  </div>
  }

  <!-- Pending buffer (creation mode) -->
  @if (creationMode && pendingFiles.length > 0) {
  <div class="attachment-tags">
    @for (file of pendingFiles; track trackByFile($index, file)) {
    <app-attachment-tag
      [filename]="file.name"
      [pending]="true"
      (delete)="onDeletePendingFile(file.name)"
    />
    }
  </div>
  } @if ((attachments.length === 0) && (!creationMode || pendingFiles.length ===
  0)) {
  <div class="empty-upload-text">
    <span class="fake-link">{{ "common.chooseFile" | transloco }}</span>
  </div>
  }

  <!-- Image preview popover (presentational) -->
  <app-image-preview-popover
    [url]="previewUrl()"
    [x]="previewLeft()"
    [y]="previewTop()"
    [visible]="!!previewUrl()"
  />
</div>
