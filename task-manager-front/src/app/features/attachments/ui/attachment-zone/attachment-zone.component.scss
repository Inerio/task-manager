@use "../../../../../styles/_breakpoints" as bp;

.attachments-zone {
  position: relative;
  background: var(--surface-1);
  border: 1px dashed var(--border-2);
  border-radius: var(--radius-2);
  padding: 0.6rem 0.5rem;
  margin: 0.25rem 0 0.4rem;
  font-size: 0.92rem;
  min-height: 0;
  box-shadow: var(--shadow-1);
  transition: background 0.18s, border-color 0.18s, box-shadow 0.18s;

  &.drag-over {
    border-color: var(--brand);
    background: #eaf4ff;
    box-shadow: 0 0 0 3px color-mix(in oklab, var(--brand) 25%, transparent);
  }

  /* Compact delete-all button pinned to the top-left corner */
  .edge-delete {
    position: absolute;
    top: 0;
    left: 0;
    transform: translate(-45%, -45%); /* conserve la position exacte */
    width: 18px;
    height: 18px;
    min-width: 18px;
    min-height: 18px;
    border-radius: 999px;
    /* plus de rouge: pastille neutre, légèrement détachée du fond */
    border: 1px solid var(--border-2);
    background: color-mix(in oklab, var(--surface-1) 80%, white);
    /* anneau pour lisibilité sur fonds sombres/clairs */
    box-shadow: 0 1px 3px #0002, 0 0 0 2px var(--surface-1);
    z-index: 2;

    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    padding: 0;
    line-height: 1;
    transition: background 0.15s ease, border-color 0.15s ease,
      transform 0.12s ease, opacity 0.12s ease;

    /* icône blanche un peu adoucie au repos */
    img {
      pointer-events: none;
      display: block;
      width: 12px;
      height: 12px;
      opacity: 0.8;
      transition: opacity 0.12s ease;
    }

    &:hover {
      background: color-mix(in oklab, var(--surface-1) 60%, white);
      border-color: var(--border-2);
      img {
        opacity: 1;
      }
    }

    &:active {
      transform: translate(-45%, -45%) scale(0.96);
    }

    &:focus-visible {
      outline: 2px solid var(--brand);
      outline-offset: 1px;
      img {
        opacity: 1;
      }
    }
  }

  .visually-hidden-file-input {
    position: absolute;
    width: 1px;
    height: 1px;
    opacity: 0;
    pointer-events: none;
    left: -9999px;
    top: -9999px;
  }

  /* Wrapper */
  .attachments-list {
    position: relative;
    overflow: visible;

    &.clamped {
      overflow: hidden;
      background: color-mix(in oklab, var(--brand) 7%, var(--surface-1));
      border-radius: var(--radius-2);
    }

    &.has-toggle {
      padding-bottom: 1.6rem;
    }
  }

  &:has(.attachments-toggle) .attachments-list {
    padding-bottom: 1.6rem;
  }

  .attachment-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin-bottom: 0;
  }

  .empty-upload-text {
    padding: 0.08rem 0.05rem;
    color: #7a869a;
    font-size: 0.96em;
    text-align: left;
    user-select: none;

    .fake-link {
      color: var(--brand);
      text-decoration: underline dotted;
      cursor: pointer;
      font-weight: 500;
    }
  }

  .attachments-toggle {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0.3rem;
    display: flex;
    justify-content: center;
    pointer-events: none;

    .toggle-btn {
      pointer-events: auto;
      appearance: none;
      border: 1px solid var(--border-2);
      background: var(--surface-1);
      border-radius: 999px;
      padding: 0.14rem 0.42rem;
      line-height: 1;
      cursor: pointer;
      box-shadow: 0 1px 2px #0001;
      transition: background 0.15s, border-color 0.15s;

      &:hover {
        background: color-mix(in oklab, var(--surface-1) 92%, #000);
      }

      .chevron {
        display: inline-block;
        width: 0.5rem;
        height: 0.5rem;
        border-right: 2px solid currentColor;
        border-bottom: 2px solid currentColor;
        transform: rotate(45deg);
        transition: transform 0.18s ease;

        &.up {
          transform: rotate(-135deg);
        }
      }
    }
  }
}
